version: '3'

services:
  obsidian:
    image: 'ghcr.io/sytone/obsidian-remote:latest'
    container_name: obsidian-remote
    restart: unless-stopped
    networks:
      - obsidian_network
    volumes:
      - $OBSIDIAN_VAULTS:/vaults
    ports:
      - "8080:8080"
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Denver

  organizerserver:
    image: happydance/organizerserver:latest
    environment:
      - OBSIDIAN_VAULT_REPO_LOCATION=/app/vault
    volumes:
      - $OBSIDIAN_VAULTS/SyncedVault/Organizer:/app/vault
    networks:
      - obsidian_network

  updater:
    image: updater:latest
    environment:
      - VAULT_LOCATION=/app/vault
      - USERNAME=$GUSERNAME
      - PASSWORD=$GPASSWORD
      - TOKEN=$GTOKEN
      - OUTPUT_PATH=/app/output
    volumes:
      - $OBSIDIAN_VAULTS/SyncedVault:/app/vault

  # Updated agent-server service with .env file
  agent-server:
    image: happydance/agent-server:latest
    restart: unless-stopped
    ports:
      - "5001:5001"
    environment:
      - API_URL=https://api.openai.com/v1/chat/completions
      - LLM_TYPE=ChatGPT
      - ORGANIZER_SERVER_URL=http://organizerserver:8080
    networks:
      - obsidian_network
    env_file:
      - ./dev/agent-server.env

networks:
  obsidian_network:
